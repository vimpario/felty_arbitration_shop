from typing import List
from aiogram.types import InlineKeyboardMarkup, ReplyKeyboardMarkup, InlineKeyboardButton
from aiogram.utils.keyboard import InlineKeyboardBuilder, ReplyKeyboardBuilder
from bot.config import settings
from bot.dao.models import Category


def main_user_kb(user_id: int) -> InlineKeyboardMarkup:
    kb = InlineKeyboardBuilder()
    kb.button(text="üë§ –ú–æ–∏ –ø–æ–∫—É–ø–∫–∏", callback_data="my_profile")
    kb.button(text="üõç –ö–∞—Ç–∞–ª–æ–≥", callback_data="catalog")
    kb.button(text="‚ÑπÔ∏è –û –º–∞–≥–∞–∑–∏–Ω–µ", callback_data="about")
    if user_id in settings.ADMIN_IDS:
        kb.button(text="‚öôÔ∏è –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å", callback_data="admin_panel")
    kb.adjust(1)
    return kb.as_markup()

def product_navigation_kb(category_id: int, product_index: int, total_products: int) -> InlineKeyboardMarkup:
    kb = InlineKeyboardBuilder()
    prev_index = (product_index -1) % total_products
    next_index = (product_index + 1) % total_products
    kb.button(text="<-", callback_data=f"prev_{category_id}_{prev_index}")
    kb.button(text=f"{product_index + 1}/{total_products}", callback_data="noop")
    kb.button(text="->", callback_data=f"next_{category_id}_{prev_index}")
    kb.adjust(1)
    return kb.as_markup()

def catalog_kb(catalog_data: List[Category]) -> InlineKeyboardMarkup:
    kb = InlineKeyboardBuilder()
    for category in catalog_data:
        kb.button(text=category.category_name, callback_data=f"category_{category.id}")
    kb.button(text="üè† –ù–∞ –≥–ª–∞–≤–Ω—É—é", callback_data="home")
    kb.adjust(2)
    return kb.as_markup()

def purchases_kb() -> InlineKeyboardMarkup:
    kb = InlineKeyboardBuilder()
    kb.button(text="üóë –°–º–æ—Ç—Ä–µ—Ç—å –ø–æ–∫—É–ø–∫–∏", callback_data="purchases")
    kb.button(text="üè† –ù–∞ –≥–ª–∞–≤–Ω—É—é", callback_data="home")
    kb.adjust(1)
    return kb.as_markup()

def purchase_count_kb() -> InlineKeyboardMarkup:
    kb = InlineKeyboardBuilder()
    kb.button(text="–ù–∞–∑–∞–¥", callback_data="catalog")
    kb.adjust(1)
    return kb.as_markup()

def product_kb(product_id, price) -> InlineKeyboardMarkup:
    kb = InlineKeyboardBuilder()
    kb.button(text="üí∏ –ö—É–ø–∏—Ç—å", callback_data=f"buy_{product_id}_{price}")
    kb.button(text="üõç –ù–∞–∑–∞–¥", callback_data="catalog")
    kb.button(text="üè† –ù–∞ –≥–ª–∞–≤–Ω—É—é", callback_data="home")
    kb.adjust(2)
    return kb.as_markup()

def get_product_buy_kb(price) -> InlineKeyboardMarkup:
    
    return InlineKeyboardMarkup(inline_keyboard=[
        [InlineKeyboardButton(text=f'–û–ø–ª–∞—Ç–∏—Ç—å {price}‚ÇΩ', pay=True)],
        [InlineKeyboardButton(text='–û—Ç–º–µ–Ω–∏—Ç—å', callback_data='home')]
    ])